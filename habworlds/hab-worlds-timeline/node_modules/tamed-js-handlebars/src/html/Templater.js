'use strict';
tm.add ('trg.handlebars.simple.Templater', function (o, p, d) {
    function compile (data) {
        var compiled, template;

        // Compile the template
        template = d.cache [data.name]
        if (template) {
            template = Handlebars.compile (template);

            // Pass our data to the template
            compiled = template (data.context);

            // Add the compiled html to the page
            if (data.append) {
                $ (data.selector).append (compiled);
            }
            else {
                $ (data.selector).html (compiled);
            }
        }
        else {
            throw new Error ('Unable to find handlebars template: ' + data.name)
        }
    }

    o.setup = function (config) {
        d.cache = {};
        d.compiled = {};
    }

    o.html = function (name, context) {
        var data, item;

        item = d.compiled [name];
        data = {
            name: name,
            context: context.data,
            selector: context.selector,
            append: context.append,
        }
        if (item) {
            return item (data);
        }
        compile (data);
    }

    o.addHtml = function (name, template) {
        var item;

        item = d.cache [name];
        if (!item && template) {
            d.cache [name] = template;
            return template;
        }
    }
})
