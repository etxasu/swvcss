module.exports = function (req, res, next) {
	var cmd, mode, urlList;

	if (!global.cmd) {
		global.cmd = require ('node-cmd');
	}

	cmd = global.cmd;
	mode = 'build';
	urlList = [
		'/src/test/'
	]

	if (mode == 'build') {
		// Normal build.
		if (urlList.indexOf (req.url) > -1) {
			console.log ('- rebuilding the /dist files.')

			cmd.get ('npx gulp build', function (err, data, stderr) {
				if (data) { console.log (data); }
				if (stderr) { console.log ('- error:', stderr); }

				if (err) { console.error ('- exec error: ' + err); }
				next ();
			})
		}
		else {
			next ();
		}
	}
	else {
		// Live build.
		if (!global.isLiveBuild) {
	        global.isLiveBuild = true;

	        var spawn = require ('child_process').spawn;
	        var child = spawn ('reset; npx gulp live-build', {shell: true});

	        child.stderr.on ('data', function (data) {
	            console.error ('', data.toString ());
	        });

	        child.stdout.on ('data', function (data) {
	            console.log ('', data.toString ());
	        });

	        child.on('exit', function (exitCode) {
	            console.log ("Child exited with code: " + exitCode);
	        });

	        next ();
	    }
	    else {
	        next();
	    }
	}
}
