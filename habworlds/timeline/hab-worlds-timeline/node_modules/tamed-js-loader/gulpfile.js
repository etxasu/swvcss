// grab our gulp packages
var
    gulp  = require ('gulp'),
    watch = require ('gulp-watch'),
    clean = require ('gulp-clean'),
    concat = require ('gulp-concat'),
    debug = require ('gulp-debug'),
    rename = require ('gulp-rename'),
    vinylPaths = require ('vinyl-paths'),
    uglify = require ('gulp-uglify')

function compile (target) {
    return gulp.src([
        './src/loader/simple/type/AjaxLoader.js',
        './src/loader/simple/type/Handlebars.js',
        './src/loader/simple/type/Text.js',
        './src/loader/simple/Cache.js',
        './src/loader/simple/LoadByType.js',
        './src/loader/simple/LoaderQueue.js',
        './src/loader/simple/Loader.js',
        './src/TamedLoader.js',
        './src/TamedSimpleLoader.js',
        ])
        .pipe (debug ({title: 'compile:'}))
        .pipe (concat (target))
        .pipe (gulp.dest ('./dist/'))
}

gulp.task ('live-build', function () {
    return watch ('src/**/*.js', gulp.parallel ('build'));
})

gulp.task ('clean', function () {
    return gulp.src (['./dist/*'], {read: false})
        .pipe (debug ({title: 'clean:'}))
        .pipe (clean ());
})

gulp.task ('compile-tamed-loader', function () {
    return compile ('tamed-loader.js')
})

gulp.task ('compile-tamed-loader-simple', function () {
    return compile ('tamed-loader-simple.js')
})

gulp.task ('compile-tamed-loader-full', function () {
    return compile ('tamed-loader-full.js')
})

gulp.task ('minify', function () {
    return gulp.src (['./dist/*.js'])
        .pipe (debug ({title: 'minify:'}))
        .pipe (uglify ())
        .pipe (rename ({suffix: '.min'}))
        .pipe (gulp.dest ('./dist/'))
})

// create a default task and just log a message
gulp.task ('build', gulp.series ('clean', 'compile-tamed-loader', 'compile-tamed-loader-simple', 'compile-tamed-loader-full', 'minify'));
gulp.task ('default', gulp.series ('clean'));
